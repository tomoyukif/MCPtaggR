---
title: "ErrorCorrectionWithGBScleanR"
author: "Tomoyuki Furuta"
date: "Oct 28, 2021"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ErrorCorrectionWithGBScleanR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

\section{Introduction}
The `GBScleanR` package has been mainly developed to conduct error correction on genotype data obtained via NGS-base genotyping methods such as RAD-seq and GBS. We can also clean up genotype data obtained via SInG with `GBScleanR`.


You can install `GBScleanR` from the Bioconductor repository with the following code.
```{r eval=FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("GBScleanR")
```
\  

The code below let you install the package from the github repository.
```{r eval=FALSE}
if (!requireNamespace("devtools", quietly = TRUE))
    install.packages("devtools")
devtools::install_github("tomoyukif/GBScleanR", build_vignettes = TRUE)
```


To load the package.
```{r message=FALSE, warning=FALSE}
library("GBScleanR")
```



First, we need to convert our VCF file into a GDS file to handle genotype data via the `GBScleanR` functions.
```{r message=FALSE, warning=FALSE}
vcf_fn <- "~/hdd3/kishima/A2Fs/SInG_result.vcf"
gds_fn <- "~/hdd3/kishima/A2Fs/SInG_result.gds"
gbsrVCF2GDS(vcf_fn, gds_fn, force = TRUE)
```



Open the connection to the GDS file and build a GbsrGenotypeData object.
```{r}
gds <- loadGDS(gds_fn)
```


Check data.
```{r}
nscan(gds)
```
```{r}
nsnp(gds)
```
```{r}
getScanID(gds)
```



Check genotype and read count summary.
```{r}
gds <- countGenotype(gds)
gds <- countRead(gds)
```



Draw plots to show statistical summary.
```{r}
histGBSR(gds, stats = "missing")
```
```{r}
histGBSR(gds, stats = "dp")
```
```{r}
histGBSR(gds, stats = "het")
```
```{r}
histGBSR(gds, stats = "rrf")
```



Set parental samples and prepare a GbsrScheme object.
```{r}
gds <- setParents(gds, parents = c("Ref", "Alt"))
```
```{r}
gds <- initScheme(gds, "pair", cbind(c(1:2)))
gds <- addScheme(gds, "self")
```



Execute error correction.
```{r}
gds <- estGeno(gds, optim = FALSE, n_threads = 10)
```


```{r}
pdf("~/hdd3/kishima/A2Fs/plots/A2F-1_corrected_Dosage.pdf")
plotDosage(gds, coord = c(6, 2), ind = 3, node = "cor")
dev.off()
pdf("~/hdd3/kishima/A2Fs/plots/A2F-2_corrected_Dosage.pdf")
plotDosage(gds, coord = c(6, 2), ind = 4, node = "cor")
dev.off()
pdf("~/hdd3/kishima/A2Fs/plots/A2F-3_corrected_Dosage.pdf")
plotDosage(gds, coord = c(6, 2), ind = 5, node = "cor")
dev.off()
```

